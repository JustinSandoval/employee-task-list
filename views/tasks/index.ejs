<% layout('layouts/boilerplate') %> 
<div class="text-center">
    <h1>Employee Task List</h1>
    
    <a href="/task/add" style=background-color:#eb8934 class="btn btn-sm mb-4">Add Task</a>
    
</div>
<div class="row">
    <div class="col">
        <div class="list-group">
            <% const sortedTasks = tasks.sort((a,b) =>a.deadline-b.deadline) %> 
            <% for(let t of sortedTasks) { %>
                <a href="/task/<%= t._id %> " class="list-group-item list-group-item-action d-flex align-items-center">
                    <form action="/task/<%= t._id %>?_method=PATCH" method="POST">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="completed" onchange="this.form.submit()" id="completed" <%= t.completed === 'on' ? 'checked' : '' %>  > 
                        </div>
                    </form>
                    <span class="ms-4 me-auto"><%= t.title %></span>

                    <% if (t.completed === 'on') { %>
                        <small><span class="badge bg-info rounded-pill mx-3">Completed</span></small>
                    <% } else if(Date.now() > new Date(t.deadline)){ %> 
                        <small><span class="badge bg-danger rounded-pill mx-3">Overdue</span></small>
                    <% } else { %>
                        <small><span class="badge bg-success rounded-pill mx-3">In Progress</span></small>
                    <% } %>

                    <span><%= dayjs(t.deadline).format('ddd MMM D, YYYY @ h:mm a') %></span>
                </a>
            <% } %> 
        </div>
    </div>
</div>